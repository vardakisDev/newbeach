{"ast":null,"code":"/**\n * Asset instances\n * @namespace Asset\n */\nimport cloneDeep from 'lodash/cloneDeep';\nimport { freezeSys, toPlainObject } from 'contentful-sdk-core';\nimport enhanceWithMethods from '../enhance-with-methods';\nimport errorHandler from '../error-handler';\nimport { createUpdateEntity, createDeleteEntity, createPublishEntity, createUnpublishEntity, createArchiveEntity, createUnarchiveEntity, createPublishedChecker, createUpdatedChecker, createDraftChecker, createArchivedChecker } from '../instance-actions';\nvar ASSET_PROCESSING_CHECK_WAIT = 2000;\nvar ASSET_PROCESSING_CHECK_RETRIES = 10;\n/**\n * @memberof Asset\n * @typedef Asset\n * @prop {Meta.Sys} sys - Standard system metadata with additional asset specific properties\n * @prop {string=} sys.locale - If present, indicates the locale which this asset uses\n * @prop {Object} fields - Object with content for each field\n * @prop {string} fields.title - Title for this asset\n * @prop {string} fields.description - Description for this asset\n * @prop {Object} fields.file - File object for this asset\n * @prop {Object} fields.file.fileName - Name for the file\n * @prop {string} fields.file.contentType - Mime type for the file\n * @prop {string=} fields.file.upload - Url where the file is available to be downloaded from, into the Contentful asset system. After the asset is processed this field is gone.\n * @prop {string=} fields.file.url - Url where the file is available at the Contentful media asset system. This field won't be available until the asset is processed.\n * @prop {Object} fields.file.details - Details for the file, depending on file type (example: image size in bytes, etc)\n * @prop {function(): Object} toPlainObject() - Returns this Asset as a plain JS object\n */\n\nfunction createAssetApi(http) {\n  function checkIfAssetHasUrl(_ref) {\n    var resolve = _ref.resolve,\n        reject = _ref.reject,\n        id = _ref.id,\n        locale = _ref.locale,\n        _ref$processingCheckW = _ref.processingCheckWait,\n        processingCheckWait = _ref$processingCheckW === undefined ? ASSET_PROCESSING_CHECK_WAIT : _ref$processingCheckW,\n        _ref$processingCheckR = _ref.processingCheckRetries,\n        processingCheckRetries = _ref$processingCheckR === undefined ? ASSET_PROCESSING_CHECK_RETRIES : _ref$processingCheckR,\n        _ref$checkCount = _ref.checkCount,\n        checkCount = _ref$checkCount === undefined ? 0 : _ref$checkCount;\n    http.get('assets/' + id).then(function (response) {\n      return wrapAsset(http, response.data);\n    }, errorHandler).then(function (asset) {\n      if (asset.fields.file[locale].url) {\n        resolve(asset);\n      } else if (checkCount === processingCheckRetries) {\n        var error = new Error();\n        error.name = 'AssetProcessingTimeout';\n        error.message = 'Asset is taking longer then expected to process.';\n        reject(error);\n      } else {\n        checkCount++;\n        setTimeout(function () {\n          return checkIfAssetHasUrl({\n            resolve: resolve,\n            reject: reject,\n            id: id,\n            locale: locale,\n            checkCount: checkCount,\n            processingCheckWait: processingCheckWait,\n            processingCheckRetries: processingCheckRetries\n          });\n        }, processingCheckWait);\n      }\n    });\n  }\n\n  function processForLocale(locale) {\n    var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        processingCheckWait = _ref2.processingCheckWait,\n        processingCheckRetries = _ref2.processingCheckRetries;\n\n    var assetId = this.sys.id;\n    return http.put('assets/' + this.sys.id + '/files/' + locale + '/process', null, {\n      headers: {\n        'X-Contentful-Version': this.sys.version\n      }\n    }).then(function () {\n      return new Promise(function (resolve, reject) {\n        return checkIfAssetHasUrl({\n          resolve: resolve,\n          reject: reject,\n          id: assetId,\n          locale: locale,\n          processingCheckWait: processingCheckWait,\n          processingCheckRetries: processingCheckRetries\n        });\n      });\n    }, errorHandler);\n  }\n\n  function processForAllLocales() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var self = this;\n    var locales = Object.keys(this.fields.file || {});\n    var mostUpToDateAssetVersion = void 0; // Let all the locales process\n    // Since they all resolve at different times,\n    // we need to pick the last resolved value\n    // to reflect the most recent state\n\n    var allProcessingLocales = locales.map(function (locale) {\n      return processForLocale.call(self, locale, options).then(function (result) {\n        // Side effect of always setting the most up to date asset version\n        // The last one to call this will be the last one that finished\n        // and thus the most up to date\n        mostUpToDateAssetVersion = result;\n      });\n    });\n    return Promise.all(allProcessingLocales).then(function () {\n      return mostUpToDateAssetVersion;\n    });\n  }\n\n  return {\n    /**\n     * Sends an update to the server with any changes made to the object's properties\n     * @memberof Asset\n     * @func update\n     * @return {Promise<Asset>} Object returned from the server with updated changes.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => {\n     *   asset.fields.title['en-US'] = 'New asset title'\n     *   return asset.update()\n     * })\n     * .then((asset) => console.log(`Asset ${asset.sys.id} updated.`)\n     * .catch(console.error)\n    */\n    update: createUpdateEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Deletes this object on the server.\n     * @memberof Asset\n     * @func delete\n     * @return {Promise} Promise for the deletion. It contains no data, but the Promise error case should be handled.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.delete())\n     * .then((asset) => console.log(`Asset deleted.`)\n     * .catch(console.error)\n     */\n    delete: createDeleteEntity({\n      http: http,\n      entityPath: 'assets'\n    }),\n\n    /**\n     * Publishes the object\n     * @memberof Asset\n     * @func publish\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.publish())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} published.`)\n     * .catch(console.error)\n    */\n    publish: createPublishEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Unpublishes the object\n     * @memberof Asset\n     * @func unpublish\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.unpublish())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} unpublished.`)\n     * .catch(console.error)\n    */\n    unpublish: createUnpublishEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Archives the object\n     * @memberof Asset\n     * @func archive\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.archive())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} archived.`)\n     * .catch(console.error)\n    */\n    archive: createArchiveEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Unarchives the object\n     * @memberof Asset\n     * @func unarchive\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.unarchive())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} unarchived.`)\n     * .catch(console.error)\n    */\n    unarchive: createUnarchiveEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Triggers asset processing after an upload, for the file uploaded to a specific locale.\n     * @memberof Asset\n     * @func processForLocale\n     * @param {string} locale - Locale which processing should be triggered for\n     * @param {object} options - Additional options for processing\n     * @prop {number} options.processingCheckWait - Time in milliseconds to wait before checking again if the asset has been processed (default: 500ms)\n     * @prop {number} options.processingCheckRetries - Maximum amount of times to check if the asset has been processed (default: 5)\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @throws {AssetProcessingTimeout} If the asset takes too long to process. If this happens, retrieve the asset again, and if the url property is available, then processing has succeeded. If not, your file might be damaged.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     * client.getSpace('<space_id>')\n     * .then((space) => space.createAssetWithId('<asset_id>', {\n     *   title: {\n     *     'en-US': 'Playsam Streamliner',\n     *   },\n     *   file: {\n     *     'en-US': {\n     *       contentType: 'image/jpeg',\n     *       fileName: 'example.jpeg',\n     *       upload: 'https://example.com/example.jpg'\n     *     }\n     *   }\n     * }))\n     * .then((asset) => asset.processForLocale('en-US'))\n     * .then((asset) => console.log(asset))\n     * .catch(console.error)\n     */\n    processForLocale: processForLocale,\n\n    /**\n     * Triggers asset processing after an upload, for the files uploaded to all locales of an asset.\n     * @memberof Asset\n     * @func processForAllLocales\n     * @param {object} options - Additional options for processing\n     * @prop {number} options.processingCheckWait - Time in milliseconds to wait before checking again if the asset has been processed (default: 500ms)\n     * @prop {number} options.processingCheckRetries - Maximum amount of times to check if the asset has been processed (default: 5)\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @throws {AssetProcessingTimeout} If the asset takes too long to process. If this happens, retrieve the asset again, and if the url property is available, then processing has succeeded. If not, your file might be damaged.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     * client.getSpace('<space_id>')\n     * .then((space) => space.createAssetWithId('<asset_id>', {\n     *   title: {\n     *     'en-US': 'Playsam Streamliner',\n     *     'de-DE': 'Playsam Streamliner'\n     *   },\n     *   file: {\n     *     'en-US': {\n     *       contentType: 'image/jpeg',\n     *       fileName: 'example.jpeg',\n     *       upload: 'https://example.com/example.jpg'\n     *     },\n     *     'de-DE': {\n     *       contentType: 'image/jpeg',\n     *       fileName: 'example.jpeg',\n     *       upload: 'https://example.com/example-de.jpg'\n     *     }\n     *   }\n     * }))\n     * .then((asset) => asset.processForAllLocales())\n     * .then((asset) => console.log(asset))\n     * .catch(console.error)\n     */\n    processForAllLocales: processForAllLocales,\n\n    /**\n     * Checks if the asset is published. A published asset might have unpublished changes (@see {Asset.isUpdated})\n     * @memberof Asset\n     * @func isPublished\n     * @return {boolean}\n     */\n    isPublished: createPublishedChecker(),\n\n    /**\n     * Checks if the asset is updated. This means the asset was previously published but has unpublished changes.\n     * @memberof Asset\n     * @func isUpdated\n     * @return {boolean}\n     */\n    isUpdated: createUpdatedChecker(),\n\n    /**\n     * Checks if the asset is in draft mode. This means it is not published.\n     * @memberof Asset\n     * @func isDraft\n     * @return {boolean}\n     */\n    isDraft: createDraftChecker(),\n\n    /**\n     * Checks if asset is archived. This means it's not exposed to the Delivery/Preview APIs.\n     * @memberof Asset\n     * @func isArchived\n     * @return {boolean}\n     */\n    isArchived: createArchivedChecker()\n  };\n}\n/**\n * @private\n * @param {Object} http - HTTP client instance\n * @param {Object} data - Raw asset data\n * @return {Asset} Wrapped asset data\n */\n\n\nexport function wrapAsset(http, data) {\n  var asset = toPlainObject(cloneDeep(data));\n  enhanceWithMethods(asset, createAssetApi(http));\n  return freezeSys(asset);\n}\n/**\n * @private\n * @param {Object} http - HTTP client instance\n * @param {Object} data - Raw asset collection data\n * @return {AssetCollection} Wrapped asset collection data\n */\n\nexport function wrapAssetCollection(http, data) {\n  var assets = toPlainObject(cloneDeep(data));\n  assets.items = assets.items.map(function (entity) {\n    return wrapAsset(http, entity);\n  });\n  return freezeSys(assets);\n}","map":{"version":3,"sources":["C:/Users/στελης/Desktop/Hotel React/resort/node_modules/contentful-management/dist/es-modules/entities/asset.js"],"names":["cloneDeep","freezeSys","toPlainObject","enhanceWithMethods","errorHandler","createUpdateEntity","createDeleteEntity","createPublishEntity","createUnpublishEntity","createArchiveEntity","createUnarchiveEntity","createPublishedChecker","createUpdatedChecker","createDraftChecker","createArchivedChecker","ASSET_PROCESSING_CHECK_WAIT","ASSET_PROCESSING_CHECK_RETRIES","createAssetApi","http","checkIfAssetHasUrl","_ref","resolve","reject","id","locale","_ref$processingCheckW","processingCheckWait","undefined","_ref$processingCheckR","processingCheckRetries","_ref$checkCount","checkCount","get","then","response","wrapAsset","data","asset","fields","file","url","error","Error","name","message","setTimeout","processForLocale","_ref2","arguments","length","assetId","sys","put","headers","version","Promise","processForAllLocales","options","self","locales","Object","keys","mostUpToDateAssetVersion","allProcessingLocales","map","call","result","all","update","entityPath","wrapperMethod","delete","publish","unpublish","archive","unarchive","isPublished","isUpdated","isDraft","isArchived","wrapAssetCollection","assets","items","entity"],"mappings":"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","sourcesContent":["/**\n * Asset instances\n * @namespace Asset\n */\n\nimport cloneDeep from 'lodash/cloneDeep';\nimport { freezeSys, toPlainObject } from 'contentful-sdk-core';\nimport enhanceWithMethods from '../enhance-with-methods';\nimport errorHandler from '../error-handler';\nimport { createUpdateEntity, createDeleteEntity, createPublishEntity, createUnpublishEntity, createArchiveEntity, createUnarchiveEntity, createPublishedChecker, createUpdatedChecker, createDraftChecker, createArchivedChecker } from '../instance-actions';\n\nvar ASSET_PROCESSING_CHECK_WAIT = 2000;\nvar ASSET_PROCESSING_CHECK_RETRIES = 10;\n\n/**\n * @memberof Asset\n * @typedef Asset\n * @prop {Meta.Sys} sys - Standard system metadata with additional asset specific properties\n * @prop {string=} sys.locale - If present, indicates the locale which this asset uses\n * @prop {Object} fields - Object with content for each field\n * @prop {string} fields.title - Title for this asset\n * @prop {string} fields.description - Description for this asset\n * @prop {Object} fields.file - File object for this asset\n * @prop {Object} fields.file.fileName - Name for the file\n * @prop {string} fields.file.contentType - Mime type for the file\n * @prop {string=} fields.file.upload - Url where the file is available to be downloaded from, into the Contentful asset system. After the asset is processed this field is gone.\n * @prop {string=} fields.file.url - Url where the file is available at the Contentful media asset system. This field won't be available until the asset is processed.\n * @prop {Object} fields.file.details - Details for the file, depending on file type (example: image size in bytes, etc)\n * @prop {function(): Object} toPlainObject() - Returns this Asset as a plain JS object\n */\n\nfunction createAssetApi(http) {\n  function checkIfAssetHasUrl(_ref) {\n    var resolve = _ref.resolve,\n        reject = _ref.reject,\n        id = _ref.id,\n        locale = _ref.locale,\n        _ref$processingCheckW = _ref.processingCheckWait,\n        processingCheckWait = _ref$processingCheckW === undefined ? ASSET_PROCESSING_CHECK_WAIT : _ref$processingCheckW,\n        _ref$processingCheckR = _ref.processingCheckRetries,\n        processingCheckRetries = _ref$processingCheckR === undefined ? ASSET_PROCESSING_CHECK_RETRIES : _ref$processingCheckR,\n        _ref$checkCount = _ref.checkCount,\n        checkCount = _ref$checkCount === undefined ? 0 : _ref$checkCount;\n\n    http.get('assets/' + id).then(function (response) {\n      return wrapAsset(http, response.data);\n    }, errorHandler).then(function (asset) {\n      if (asset.fields.file[locale].url) {\n        resolve(asset);\n      } else if (checkCount === processingCheckRetries) {\n        var error = new Error();\n        error.name = 'AssetProcessingTimeout';\n        error.message = 'Asset is taking longer then expected to process.';\n        reject(error);\n      } else {\n        checkCount++;\n        setTimeout(function () {\n          return checkIfAssetHasUrl({\n            resolve: resolve,\n            reject: reject,\n            id: id,\n            locale: locale,\n            checkCount: checkCount,\n            processingCheckWait: processingCheckWait,\n            processingCheckRetries: processingCheckRetries\n          });\n        }, processingCheckWait);\n      }\n    });\n  }\n\n  function processForLocale(locale) {\n    var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        processingCheckWait = _ref2.processingCheckWait,\n        processingCheckRetries = _ref2.processingCheckRetries;\n\n    var assetId = this.sys.id;\n    return http.put('assets/' + this.sys.id + '/files/' + locale + '/process', null, {\n      headers: {\n        'X-Contentful-Version': this.sys.version\n      }\n    }).then(function () {\n      return new Promise(function (resolve, reject) {\n        return checkIfAssetHasUrl({\n          resolve: resolve,\n          reject: reject,\n          id: assetId,\n          locale: locale,\n          processingCheckWait: processingCheckWait,\n          processingCheckRetries: processingCheckRetries\n        });\n      });\n    }, errorHandler);\n  }\n\n  function processForAllLocales() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    var self = this;\n    var locales = Object.keys(this.fields.file || {});\n\n    var mostUpToDateAssetVersion = void 0;\n\n    // Let all the locales process\n    // Since they all resolve at different times,\n    // we need to pick the last resolved value\n    // to reflect the most recent state\n    var allProcessingLocales = locales.map(function (locale) {\n      return processForLocale.call(self, locale, options).then(function (result) {\n        // Side effect of always setting the most up to date asset version\n        // The last one to call this will be the last one that finished\n        // and thus the most up to date\n        mostUpToDateAssetVersion = result;\n      });\n    });\n\n    return Promise.all(allProcessingLocales).then(function () {\n      return mostUpToDateAssetVersion;\n    });\n  }\n\n  return {\n    /**\n     * Sends an update to the server with any changes made to the object's properties\n     * @memberof Asset\n     * @func update\n     * @return {Promise<Asset>} Object returned from the server with updated changes.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => {\n     *   asset.fields.title['en-US'] = 'New asset title'\n     *   return asset.update()\n     * })\n     * .then((asset) => console.log(`Asset ${asset.sys.id} updated.`)\n     * .catch(console.error)\n    */\n    update: createUpdateEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Deletes this object on the server.\n     * @memberof Asset\n     * @func delete\n     * @return {Promise} Promise for the deletion. It contains no data, but the Promise error case should be handled.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.delete())\n     * .then((asset) => console.log(`Asset deleted.`)\n     * .catch(console.error)\n     */\n    delete: createDeleteEntity({\n      http: http,\n      entityPath: 'assets'\n    }),\n\n    /**\n     * Publishes the object\n     * @memberof Asset\n     * @func publish\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.publish())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} published.`)\n     * .catch(console.error)\n    */\n    publish: createPublishEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Unpublishes the object\n     * @memberof Asset\n     * @func unpublish\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.unpublish())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} unpublished.`)\n     * .catch(console.error)\n    */\n    unpublish: createUnpublishEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Archives the object\n     * @memberof Asset\n     * @func archive\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.archive())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} archived.`)\n     * .catch(console.error)\n    */\n    archive: createArchiveEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Unarchives the object\n     * @memberof Asset\n     * @func unarchive\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     *\n     * client.getSpace('<space_id>')\n     * .then((space) => space.getAsset('<asset_id>'))\n     * .then((asset) => asset.unarchive())\n     * .then((asset) => console.log(`Asset ${asset.sys.id} unarchived.`)\n     * .catch(console.error)\n    */\n    unarchive: createUnarchiveEntity({\n      http: http,\n      entityPath: 'assets',\n      wrapperMethod: wrapAsset\n    }),\n\n    /**\n     * Triggers asset processing after an upload, for the file uploaded to a specific locale.\n     * @memberof Asset\n     * @func processForLocale\n     * @param {string} locale - Locale which processing should be triggered for\n     * @param {object} options - Additional options for processing\n     * @prop {number} options.processingCheckWait - Time in milliseconds to wait before checking again if the asset has been processed (default: 500ms)\n     * @prop {number} options.processingCheckRetries - Maximum amount of times to check if the asset has been processed (default: 5)\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @throws {AssetProcessingTimeout} If the asset takes too long to process. If this happens, retrieve the asset again, and if the url property is available, then processing has succeeded. If not, your file might be damaged.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     * client.getSpace('<space_id>')\n     * .then((space) => space.createAssetWithId('<asset_id>', {\n     *   title: {\n     *     'en-US': 'Playsam Streamliner',\n     *   },\n     *   file: {\n     *     'en-US': {\n     *       contentType: 'image/jpeg',\n     *       fileName: 'example.jpeg',\n     *       upload: 'https://example.com/example.jpg'\n     *     }\n     *   }\n     * }))\n     * .then((asset) => asset.processForLocale('en-US'))\n     * .then((asset) => console.log(asset))\n     * .catch(console.error)\n     */\n    processForLocale: processForLocale,\n\n    /**\n     * Triggers asset processing after an upload, for the files uploaded to all locales of an asset.\n     * @memberof Asset\n     * @func processForAllLocales\n     * @param {object} options - Additional options for processing\n     * @prop {number} options.processingCheckWait - Time in milliseconds to wait before checking again if the asset has been processed (default: 500ms)\n     * @prop {number} options.processingCheckRetries - Maximum amount of times to check if the asset has been processed (default: 5)\n     * @return {Promise<Asset>} Object returned from the server with updated metadata.\n     * @throws {AssetProcessingTimeout} If the asset takes too long to process. If this happens, retrieve the asset again, and if the url property is available, then processing has succeeded. If not, your file might be damaged.\n     * @example\n     * const contentful = require('contentful-management')\n     *\n     * const client = contentful.createClient({\n     *   accessToken: '<content_management_api_key>'\n     * })\n     * client.getSpace('<space_id>')\n     * .then((space) => space.createAssetWithId('<asset_id>', {\n     *   title: {\n     *     'en-US': 'Playsam Streamliner',\n     *     'de-DE': 'Playsam Streamliner'\n     *   },\n     *   file: {\n     *     'en-US': {\n     *       contentType: 'image/jpeg',\n     *       fileName: 'example.jpeg',\n     *       upload: 'https://example.com/example.jpg'\n     *     },\n     *     'de-DE': {\n     *       contentType: 'image/jpeg',\n     *       fileName: 'example.jpeg',\n     *       upload: 'https://example.com/example-de.jpg'\n     *     }\n     *   }\n     * }))\n     * .then((asset) => asset.processForAllLocales())\n     * .then((asset) => console.log(asset))\n     * .catch(console.error)\n     */\n    processForAllLocales: processForAllLocales,\n\n    /**\n     * Checks if the asset is published. A published asset might have unpublished changes (@see {Asset.isUpdated})\n     * @memberof Asset\n     * @func isPublished\n     * @return {boolean}\n     */\n    isPublished: createPublishedChecker(),\n\n    /**\n     * Checks if the asset is updated. This means the asset was previously published but has unpublished changes.\n     * @memberof Asset\n     * @func isUpdated\n     * @return {boolean}\n     */\n    isUpdated: createUpdatedChecker(),\n\n    /**\n     * Checks if the asset is in draft mode. This means it is not published.\n     * @memberof Asset\n     * @func isDraft\n     * @return {boolean}\n     */\n    isDraft: createDraftChecker(),\n\n    /**\n     * Checks if asset is archived. This means it's not exposed to the Delivery/Preview APIs.\n     * @memberof Asset\n     * @func isArchived\n     * @return {boolean}\n     */\n    isArchived: createArchivedChecker()\n  };\n}\n\n/**\n * @private\n * @param {Object} http - HTTP client instance\n * @param {Object} data - Raw asset data\n * @return {Asset} Wrapped asset data\n */\nexport function wrapAsset(http, data) {\n  var asset = toPlainObject(cloneDeep(data));\n  enhanceWithMethods(asset, createAssetApi(http));\n  return freezeSys(asset);\n}\n\n/**\n * @private\n * @param {Object} http - HTTP client instance\n * @param {Object} data - Raw asset collection data\n * @return {AssetCollection} Wrapped asset collection data\n */\nexport function wrapAssetCollection(http, data) {\n  var assets = toPlainObject(cloneDeep(data));\n  assets.items = assets.items.map(function (entity) {\n    return wrapAsset(http, entity);\n  });\n  return freezeSys(assets);\n}"]},"metadata":{},"sourceType":"module"}